<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´ªåƒè›‡ - è¶£å‘³å°æ¸¸æˆ</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>ğŸ è´ªåƒè›‡</h1>
        <p>ä½¿ç”¨æ–¹å‘é”®æ§åˆ¶è›‡çš„ç§»åŠ¨ï¼Œåƒåˆ°é£Ÿç‰©è·å¾—åˆ†æ•°ï¼</p>
    </header>

    <main>
        <div class="game-container">
            <div class="game-header">
                <a href="index.html" class="back-btn">â† è¿”å›ä¸»é¡µ</a>
                <div class="score">åˆ†æ•°: <span id="score">0</span></div>
                <div class="score">æœ€é«˜åˆ†: <span id="high-score">0</span></div>
            </div>
            
            <canvas id="gameCanvas" class="game-canvas" width="400" height="400"></canvas>
            
            <div class="game-controls">
                <button id="startBtn" class="control-btn">å¼€å§‹æ¸¸æˆ</button>
                <button id="pauseBtn" class="control-btn" disabled>æš‚åœ</button>
                <button id="resetBtn" class="control-btn">é‡æ–°å¼€å§‹</button>
            </div>
            
            <div style="margin-top: 1rem; text-align: center; color: #666;">
                <p>ä½¿ç”¨æ–¹å‘é”® â†‘â†“â†â†’ æ§åˆ¶è›‡çš„ç§»åŠ¨</p>
                <p>æˆ–è€…ä½¿ç”¨ WASD é”®æ§åˆ¶</p>
                <p id="current-time" style="margin-top: 0.5rem; font-size: 0.9rem;"></p>
            </div>
        </div>
    </main>

    <script src="main.js"></script>
    <script>
        /**
         * è´ªåƒè›‡æ¸¸æˆç±»
         */
        class SnakeGame {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.gridSize = 20;
                this.tileCount = this.canvas.width / this.gridSize;
                
                this.snake = [
                    {x: 10, y: 10}
                ];
                this.food = {};
                this.dx = 0;
                this.dy = 0;
                this.score = 0;
                this.highScore = Utils.storage.get('snake-high-score', 0);
                this.gameRunning = false;
                this.gamePaused = false;
                
                this.init();
            }
            
            /**
             * åˆå§‹åŒ–æ¸¸æˆ
             */
            init() {
                this.generateFood();
                this.updateScore();
                this.updateHighScore();
                this.setupEventListeners();
                this.draw();
            }
            
            /**
             * è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
             */
            setupEventListeners() {
                document.addEventListener('keydown', (e) => this.handleKeyPress(e));
                
                document.getElementById('startBtn').addEventListener('click', () => this.startGame());
                document.getElementById('pauseBtn').addEventListener('click', () => this.togglePause());
                document.getElementById('resetBtn').addEventListener('click', () => this.resetGame());
            }
            
            /**
             * å¤„ç†é”®ç›˜æŒ‰é”®
             * @param {KeyboardEvent} e - é”®ç›˜äº‹ä»¶
             */
            handleKeyPress(e) {
                if (!this.gameRunning || this.gamePaused) return;
                
                const key = e.key.toLowerCase();
                
                // é˜²æ­¢è›‡åå‘ç§»åŠ¨
                if ((key === 'arrowleft' || key === 'a') && this.dx !== 1) {
                    this.dx = -1;
                    this.dy = 0;
                } else if ((key === 'arrowright' || key === 'd') && this.dx !== -1) {
                    this.dx = 1;
                    this.dy = 0;
                } else if ((key === 'arrowup' || key === 'w') && this.dy !== 1) {
                    this.dx = 0;
                    this.dy = -1;
                } else if ((key === 'arrowdown' || key === 's') && this.dy !== -1) {
                    this.dx = 0;
                    this.dy = 1;
                }
            }
            
            /**
             * å¼€å§‹æ¸¸æˆ
             */
            startGame() {
                if (!this.gameRunning) {
                    this.gameRunning = true;
                    this.gamePaused = false;
                    this.dx = 1;
                    this.dy = 0;
                    this.gameLoop();
                    
                    document.getElementById('startBtn').disabled = true;
                    document.getElementById('pauseBtn').disabled = false;
                }
            }
            
            /**
             * åˆ‡æ¢æš‚åœçŠ¶æ€
             */
            togglePause() {
                if (this.gameRunning) {
                    this.gamePaused = !this.gamePaused;
                    document.getElementById('pauseBtn').textContent = this.gamePaused ? 'ç»§ç»­' : 'æš‚åœ';
                    
                    if (!this.gamePaused) {
                        this.gameLoop();
                    }
                }
            }
            
            /**
             * é‡ç½®æ¸¸æˆ
             */
            resetGame() {
                this.gameRunning = false;
                this.gamePaused = false;
                this.snake = [{x: 10, y: 10}];
                this.dx = 0;
                this.dy = 0;
                this.score = 0;
                this.generateFood();
                this.updateScore();
                this.draw();
                
                document.getElementById('startBtn').disabled = false;
                document.getElementById('pauseBtn').disabled = true;
                document.getElementById('pauseBtn').textContent = 'æš‚åœ';
            }
            
            /**
             * æ¸¸æˆä¸»å¾ªç¯
             */
            gameLoop() {
                if (!this.gameRunning || this.gamePaused) return;
                
                setTimeout(() => {
                    this.update();
                    this.draw();
                    this.gameLoop();
                }, 150);
            }
            
            /**
             * æ›´æ–°æ¸¸æˆçŠ¶æ€
             */
            update() {
                const head = {x: this.snake[0].x + this.dx, y: this.snake[0].y + this.dy};
                
                // æ£€æŸ¥ç¢°æ’
                if (this.checkCollision(head)) {
                    this.gameOver();
                    return;
                }
                
                this.snake.unshift(head);
                
                // æ£€æŸ¥æ˜¯å¦åƒåˆ°é£Ÿç‰©
                if (head.x === this.food.x && head.y === this.food.y) {
                    this.score += 10;
                    this.updateScore();
                    this.generateFood();
                } else {
                    this.snake.pop();
                }
            }
            
            /**
             * æ£€æŸ¥ç¢°æ’
             * @param {Object} head - è›‡å¤´ä½ç½®
             * @returns {boolean} æ˜¯å¦å‘ç”Ÿç¢°æ’
             */
            checkCollision(head) {
                // æ£€æŸ¥å¢™å£ç¢°æ’
                if (head.x < 0 || head.x >= this.tileCount || head.y < 0 || head.y >= this.tileCount) {
                    return true;
                }
                
                // æ£€æŸ¥è‡ªèº«ç¢°æ’
                for (let segment of this.snake) {
                    if (head.x === segment.x && head.y === segment.y) {
                        return true;
                    }
                }
                
                return false;
            }
            
            /**
             * ç”Ÿæˆé£Ÿç‰©
             */
            generateFood() {
                do {
                    this.food = {
                        x: Math.floor(Math.random() * this.tileCount),
                        y: Math.floor(Math.random() * this.tileCount)
                    };
                } while (this.snake.some(segment => segment.x === this.food.x && segment.y === this.food.y));
            }
            
            /**
             * ç»˜åˆ¶æ¸¸æˆç”»é¢
             */
            draw() {
                // æ¸…ç©ºç”»å¸ƒ
                this.ctx.fillStyle = '#f8f9fa';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // ç»˜åˆ¶è›‡
                this.ctx.fillStyle = '#28a745';
                for (let segment of this.snake) {
                    this.ctx.fillRect(segment.x * this.gridSize, segment.y * this.gridSize, this.gridSize - 2, this.gridSize - 2);
                }
                
                // ç»˜åˆ¶è›‡å¤´
                if (this.snake.length > 0) {
                    this.ctx.fillStyle = '#155724';
                    const head = this.snake[0];
                    this.ctx.fillRect(head.x * this.gridSize, head.y * this.gridSize, this.gridSize - 2, this.gridSize - 2);
                }
                
                // ç»˜åˆ¶é£Ÿç‰©
                this.ctx.fillStyle = '#dc3545';
                this.ctx.fillRect(this.food.x * this.gridSize, this.food.y * this.gridSize, this.gridSize - 2, this.gridSize - 2);
            }
            
            /**
             * æ›´æ–°åˆ†æ•°æ˜¾ç¤º
             */
            updateScore() {
                document.getElementById('score').textContent = this.score;
                
                if (this.score > this.highScore) {
                    this.highScore = this.score;
                    this.updateHighScore();
                    Utils.storage.set('snake-high-score', this.highScore);
                }
            }
            
            /**
             * æ›´æ–°æœ€é«˜åˆ†æ˜¾ç¤º
             */
            updateHighScore() {
                document.getElementById('high-score').textContent = this.highScore;
            }
            
            /**
             * æ¸¸æˆç»“æŸ
             */
            gameOver() {
                this.gameRunning = false;
                alert(`æ¸¸æˆç»“æŸï¼\næœ€ç»ˆåˆ†æ•°: ${this.score}\næœ€é«˜åˆ†: ${this.highScore}`);
                this.resetGame();
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–æ¸¸æˆ
        document.addEventListener('DOMContentLoaded', function() {
            new SnakeGame();
        });
    </script>
</body>
</html>